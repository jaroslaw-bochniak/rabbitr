onNode {
    stage('Checkout') {
        deleteDir()
        checkout scm
    }

    String projectPath = '/go/src/github.com/smartrecruiters/rabbitr'

    inDocker(image: 'sr-golang:3.1.0', srRegistry: true, params: "-v $WORKSPACE:$projectPath") {
        stage('Build') {
            // change to dir when JENKINS-33510 fixed
            sh "cd $projectPath; make install; make buildall"
        }

        stage('Test') {
            sh "cd $projectPath; make testall "
        }
    }
}

